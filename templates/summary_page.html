<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Program Summary</title>
  <link rel="stylesheet" href="../styles/dashboard.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    @media print {
      .nav-dropdown { display: none; }
      canvas { max-width: 100% !important; height: auto !important; }
    }
    .timestamp {
      position: fixed;
      bottom: 10px;
      right: 20px;
      font-size: 0.8rem;
      color: #666;
    }
  </style>
</head>
<body>
  <div class="nav-dropdown">
    <label for="nav-select">Jump to Page:</label>
    <select id="nav-select" onchange="location = this.value;">
      <option value="#">-- Select --</option>
      <option value="index.html" selected>Program Summary</option>
      <option value="sprint_readiness.html">Sprint Readiness</option>
      <option value="backlog_health.html">Backlog Health</option>
    </select>
  </div>

  <header>
    <h1>Overall Program Health</h1>
    <img src="{{ program_light }}" alt="Overall Status" class="big-stoplight">
    <p><strong>{{ program_status }}</strong> —
      {% if program_status == 'Red' %}At Risk: Needs Immediate Attention
      {% elif program_status == 'Yellow' %}Caution: Prep Work Required
      {% elif program_status == 'Green' %}On Track: No Action Needed
      {% endif %}
    </p>
  </header>

  <section>
    <h2>How This Was Calculated</h2>
    <p>The program status is based on the worst team status. Red = at least one team is Red. Yellow = at least one Yellow, none Red. Green = all teams Green.</p>
  </section>

  <section>
    <h2>Program-wide Metrics</h2>
    <div class="chart-row">
      <div class="chart-box">
        <h3>% Stories Ready</h3>
        <canvas id="readinessChart" width="160" height="160"></canvas>
        <p>Legend: Green = Platform, Yellow = Product, Red = AI Ops, Blue = Data Science, Cyan = Design</p>
      </div>
      <div class="chart-box">
        <h3>% Backlog Groomed</h3>
        <canvas id="groomingChart" width="160" height="160"></canvas>
        <p>Legend: Blue = Platform, Light Blue = Product, Aqua = AI Ops, Grey = Data Science, Teal = Design</p>
      </div>
    </div>
  </section>

  <section>
    <h2>Team-Level Breakdown</h2>
    <ul>
      {% for team in readiness %}
      <li><strong>{{ team.Team }}</strong>: {{ team['Ready %'] }}% of sprint stories are ready. Indicates how defined and actionable the team’s current sprint workload is.</li>
      {% endfor %}
    </ul>
  </section>

  <div class="timestamp">
    Last updated: {{ last_updated }}
  </div>

  <script>
    const readinessData = {
      labels: [{% for r in readiness %}"{{ r.Team }}"{% if not loop.last %},{% endif %}{% endfor %}],
      datasets: [{
        label: '% Ready',
        data: [{% for r in readiness %}{{ r['Ready %'] }}{% if not loop.last %},{% endif %}{% endfor %}],
        backgroundColor: ['#4caf50', '#cddc39', '#ffc107', '#03a9f4', '#00bcd4']
      }]
    };

    const groomingData = {
      labels: [{% for g in grooming %}"{{ g.Team }}"{% if not loop.last %},{% endif %}{% endfor %}],
      datasets: [{
        label: '% Groomed',
        data: [{% for g in grooming %}{{ g['Groomed %'] }}{% if not loop.last %},{% endif %}{% endfor %}],
        backgroundColor: ['#2196f3', '#29b6f6', '#26c6da', '#90a4ae', '#00897b']
      }]
    };

    new Chart(document.getElementById('readinessChart'), {
      type: 'doughnut',
      data: readinessData,
      options: { responsive: false, plugins: { legend: { position: 'bottom' } } }
    });

    new Chart(document.getElementById('groomingChart'), {
      type: 'doughnut',
      data: groomingData,
      options: { responsive: false, plugins: { legend: { position: 'bottom' } } }
    });

    setTimeout(() => window.location.reload(true), 300000);
  </script>
</body>
</html>
